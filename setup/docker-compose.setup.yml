# IMPORTANT:
# Set a unique Compose project name per repo. Otherwise Docker Compose can derive the project name
# from the folder name (e.g. "local-deployment"), leading to cross-repo collisions (containers,
# networks, volumes like "<project>-app-1").
name: python-api-template

services:
  setup:
    build:
      context: ..
      dockerfile: interactive-scripts/Dockerfile
    container_name: api-setup
    stdin_open: true    # Enable interactive mode (docker run -i)
    tty: true           # Allocate a pseudo-TTY (docker run -t)
    volumes:
      # Mount project directory
      - ..:/workspace
    working_dir: /workspace
    # Fix Windows line endings (CRLF) and BOM in all shell scripts, then run setup
    command: bash -c "for f in $$(find setup -name '*.sh' -type f); do dos2unix $$f 2>/dev/null || sed -i 's/\r$$//' $$f; if [ $$(head -c 3 $$f | od -An -tx1 | tr -d ' ') = 'efbbbf' ]; then tail -c +4 $$f > $$f.tmp && mv $$f.tmp $$f; fi; chmod +x $$f; done && bash setup/setup.sh"
